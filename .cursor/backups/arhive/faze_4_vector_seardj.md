
ФАЗА 4: Векторный поиск для памяти
Цель: Улучшить поиск в памяти через векторные embeddings.

Этап 4.1: Интеграция pgvector
Шаг 4.1.1: Добавить поддержку pgvector в БД
Файлы:

Миграция 022_add_vector_search.py
Обновить backend/app/core/database.py
Задача:

Установка расширения vector в PostgreSQL
Добавить векторные поля в AgentMemory
Создать индексы для векторного поиска
Тесты:

Частный: Тесты миграции
Общий: Проверка работы pgvector
Документация: Создать docs/guides/VECTOR_SEARCH.md

Коммит: feat(phase4.1.1): интеграция pgvector в БД

Шаг 4.1.2: Реализовать сервис генерации embeddings
Файлы:

backend/app/services/embedding_service.py (новый)
Задача:

Генерация embeddings для текста через LLM (или внешний сервис)
Кэширование embeddings
Нормализация векторов
Тесты:

Частный: backend/tests/test_embedding_service.py
Общий: Интеграция с MemoryService
Документация: Обновить документацию

Коммит: feat(phase4.1.2): сервис генерации embeddings

Шаг 4.1.3: Обновить MemoryService для векторного поиска
Файлы:

backend/app/services/memory_service.py
Метод search_memories_vector()
Задача:

Добавить векторный поиск похожих ситуаций
Комбинировать с существующим текстовым поиском
Оптимизация запросов
Тесты:

Частный: backend/tests/test_memory_vector_search.py
Общий: Интеграция с PlanningService
Документация: Обновить docs/guides/MEMORY_SYSTEM.md

Коммит: feat(phase4.1.3): векторный поиск в MemoryService

Тест этапа 4.1: backend/tests/integration/test_vector_search.py

Документация этапа: Обновить docs/guides/VECTOR_SEARCH.md

Коммит этапа: feat(phase4.1): интеграция pgvector

---

Этап 4.2: Автоматическая генерация embeddings
Шаг 4.2.1: Интегрировать генерацию embeddings при сохранении памяти
Файлы:

backend/app/services/memory_service.py
Обновить save_memory()
Задача:

Автоматически генерировать embedding при сохранении памяти
Сохранять embedding в векторное поле
Обработка ошибок генерации
Тесты:

Частный: Тесты автоматической генерации
Общий: Полный цикл сохранения и поиска
Документация: Обновить документацию

Коммит: feat(phase4.2.1): автоматическая генерация embeddings

Шаг 4.2.2: Создать скрипт миграции существующих данных
Файлы:

backend/scripts/migrate_memories_to_vectors.py (новый)
Задача:

Скрипт для генерации embeddings для существующих записей памяти
Batch обработка
Прогресс и логирование
Тесты:

Частный: Тесты скрипта миграции
Общий: Проверка миграции
Документация: Обновить документацию

Коммит: feat(phase4.2.2): скрипт миграции существующих данных

Тест этапа 4.2: Тест полной миграции

Документация этапа: Обновить документацию

Коммит этапа: feat(phase4.2): автоматическая генерация embeddings

---

Тест фазы 4: backend/tests/integration/test_vector_search_complete.py

Документация фазы: Создать docs/guides/VECTOR_SEARCH.md (полный обзор)

Коммит фазы: feat(phase4): векторный поиск для памяти

Правила выполнения плана
После каждого ШАГА:
Частный тест: Тест конкретной функции/метода
Общий тест: Интеграционный или комплексный тест
Документация: Обновить соответствующую документацию
Коммит: Создать коммит с описанием изменений
После каждого ЭТАПА:
Этапный тест: Комплексный тест всего этапа
Документация этапа: Создать/обновить документацию этапа
Коммит этапа: Коммит с префиксом feat(phaseX.Y):
После каждой ФАЗЫ:
Фазный тест: Полный тест всей фазы
Документация фазы: Полная документация фазы
Коммит фазы: Коммит с префиксом feat(phaseX):
Согласование между элементами:
Каждый шаг должен быть независим и тестируем
Зависимости между шагами явно указаны
Тесты каждого уровня проверяют согласованность с предыдущими уровнями
Документация обновляется на каждом уровне
Поддерживается целостность архитектуры проекта