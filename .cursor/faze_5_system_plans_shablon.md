ФАЗА 5: Система шаблонов планов
Цель: Автоматическое извлечение и использование шаблонов успешных планов.

Этап 5.1: Извлечение шаблонов из успешных планов
Шаг 5.1.1: Реализовать PlanTemplateService
Файлы:

backend/app/services/plan_template_service.py (новый)
Модель PlanTemplate (новый)
Миграция 023_add_plan_templates.py
Задача:

Извлечение шаблонов из успешных планов
Абстракция специфичных деталей
Сохранение шаблонов с метаданными
Тесты:

Частный: backend/tests/test_plan_template_service.py
Общий: Интеграция с PlanningService
Документация: Создать docs/guides/PLAN_TEMPLATES.md

Коммит: feat(phase5.1.1): PlanTemplateService

Шаг 5.1.2: Реализовать автоматическое извлечение при завершении плана
Файлы:

Интеграция в PlanningService и ExecutionService
Задача:

При успешном завершении плана анализировать его структуру
Извлекать шаблон если план соответствует критериям (успешность, качество)
Сохранять шаблон для будущего использования
Тесты:

Частный: Тесты извлечения шаблонов
Общий: Полный цикл создания и использования шаблона
Документация: Обновить документацию

Коммит: feat(phase5.1.2): автоматическое извлечение шаблонов

Шаг 5.1.3: Реализовать поиск подходящих шаблонов
Файлы:

backend/app/services/plan_template_service.py
Метод find_matching_template()
Задача:

Поиск шаблонов по описанию задачи (семантический поиск)
Ранжирование шаблонов по релевантности
Использование векторного поиска если доступен
Тесты:

Частный: Тесты поиска шаблонов
Общий: Интеграция с PlanningService
Документация: Обновить документацию

Коммит: feat(phase5.1.3): поиск подходящих шаблонов

Тест этапа 5.1: backend/tests/integration/test_plan_template_extraction.py

Документация этапа: Обновить docs/guides/PLAN_TEMPLATES.md

Коммит этапа: feat(phase5.1): извлечение шаблонов из успешных планов

---

Этап 5.2: Использование шаблонов при планировании
Шаг 5.2.1: Интегрировать шаблоны в PlanningService
Файлы:

backend/app/services/planning_service.py
Использовать PlanTemplateService в generate_plan()
Задача:

Перед генерацией плана искать подходящие шаблоны
Использовать шаблон как основу для нового плана
Адаптировать шаблон под конкретную задачу
Тесты:

Частный: Тесты использования шаблонов
Общий: Полный цикл планирования с шаблонами
Документация: Обновить документацию

Коммит: feat(phase5.2.1): интеграция шаблонов в PlanningService

Шаг 5.2.2: Реализовать адаптацию шаблона к задаче
Файлы:

backend/app/services/plan_template_service.py
Метод adapt_template()
Задача:

Замена абстрактных частей шаблона конкретными деталями задачи
Использование LLM для адаптации
Сохранение связи с оригинальным шаблоном
Тесты:

Частный: Тесты адаптации шаблонов
Общий: Интеграция
Документация: Обновить документацию

Коммит: feat(phase5.2.2): адаптация шаблона к задаче

Шаг 5.2.3: Создать API для управления шаблонами
Файлы:

backend/app/api/routes/plan_templates.py (новый)
Задача:

GET /api/plan-templates/ - список шаблонов
GET /api/plan-templates/{template_id} - детали шаблона
POST /api/plan-templates/{template_id}/use - использование шаблона
Тесты:

Частный: backend/tests/test_plan_template_api.py
Общий: Интеграция
Документация: Обновить API документацию

Коммит: feat(phase5.2.3): API для управления шаблонами

Тест этапа 5.2: backend/tests/integration/test_plan_template_usage.py

Документация этапа: Обновить документацию

Коммит этапа: feat(phase5.2): использование шаблонов при планировании

---

Тест фазы 5: backend/tests/integration/test_plan_template_system.py

Документация фазы: Создать docs/guides/PLAN_TEMPLATES.md (полный обзор)

Коммит фазы: feat(phase5): система шаблонов планов

Скрипт для генерации embeddings для существующих записей памяти
Batch обработка
Прогресс и логирование
Тесты:

Частный: Тесты скрипта миграции
Общий: Проверка миграции
Документация: Обновить документацию



Правила выполнения плана
После каждого ШАГА:
Частный тест: Тест конкретной функции/метода
Общий тест: Интеграционный или комплексный тест
Документация: Обновить соответствующую документацию
Коммит: Создать коммит с описанием изменений
После каждого ЭТАПА:
Этапный тест: Комплексный тест всего этапа
Документация этапа: Создать/обновить документацию этапа
Коммит этапа: Коммит с префиксом feat(phaseX.Y):
После каждой ФАЗЫ:
Фазный тест: Полный тест всей фазы
Документация фазы: Полная документация фазы
Коммит фазы: Коммит с префиксом feat(phaseX):
Согласование между элементами:
Каждый шаг должен быть независим и тестируем
Зависимости между шагами явно указаны
Тесты каждого уровня проверяют согласованность с предыдущими уровнями
Документация обновляется на каждом уровне
Поддерживается целостность архитектуры проекта