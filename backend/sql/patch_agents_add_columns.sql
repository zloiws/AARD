-- Add missing columns to agents table (idempotent)
ALTER TABLE agents
  ADD COLUMN IF NOT EXISTS version VARCHAR(64),
  ADD COLUMN IF NOT EXISTS parent_agent_id INTEGER,
  ADD COLUMN IF NOT EXISTS status VARCHAR(50),
  ADD COLUMN IF NOT EXISTS created_by VARCHAR(255),
  ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS activated_at TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS last_used_at TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS endpoint VARCHAR(512),
  ADD COLUMN IF NOT EXISTS last_heartbeat TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS health_status VARCHAR(50),
  ADD COLUMN IF NOT EXISTS last_health_check TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS response_time_ms INTEGER,
  ADD COLUMN IF NOT EXISTS system_prompt TEXT,
  ADD COLUMN IF NOT EXISTS capabilities JSONB,
  ADD COLUMN IF NOT EXISTS model_preference VARCHAR(255),
  ADD COLUMN IF NOT EXISTS temperature DOUBLE PRECISION,
  ADD COLUMN IF NOT EXISTS identity_id VARCHAR(255),
  ADD COLUMN IF NOT EXISTS security_policies JSONB,
  ADD COLUMN IF NOT EXISTS allowed_actions JSONB,
  ADD COLUMN IF NOT EXISTS forbidden_actions JSONB,
  ADD COLUMN IF NOT EXISTS max_concurrent_tasks INTEGER,
  ADD COLUMN IF NOT EXISTS rate_limit_per_minute INTEGER,
  ADD COLUMN IF NOT EXISTS memory_limit_mb INTEGER,
  ADD COLUMN IF NOT EXISTS total_tasks_executed INTEGER DEFAULT 0,
  ADD COLUMN IF NOT EXISTS successful_tasks INTEGER DEFAULT 0,
  ADD COLUMN IF NOT EXISTS failed_tasks INTEGER DEFAULT 0,
  ADD COLUMN IF NOT EXISTS average_execution_time DOUBLE PRECISION,
  ADD COLUMN IF NOT EXISTS success_rate DOUBLE PRECISION,
  ADD COLUMN IF NOT EXISTS agent_metadata JSONB,
  ADD COLUMN IF NOT EXISTS tags TEXT[];


