# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —ç–≤–æ–ª—é—Ü–∏–∏ AARD

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (003_evolution_system.py)
–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü:
- `prompts` - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ (5 —É—Ä–æ–≤–Ω–µ–π)
- `approval_requests` - –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- `evolution_history` - –∏—Å—Ç–æ—Ä–∏—è —ç–≤–æ–ª—é—Ü–∏–∏
- `feedback` - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- `plans` - –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

**–§–∞–π–ª:** `backend/alembic/versions/003_evolution_system.py`

### 2. –ú–æ–¥–µ–ª–∏ SQLAlchemy
–°–æ–∑–¥–∞–Ω—ã –º–æ–¥–µ–ª–∏:
- `backend/app/models/prompt.py` - –º–æ–¥–µ–ª—å –ø—Ä–æ–º–ø—Ç–æ–≤
- `backend/app/models/approval.py` - –º–æ–¥–µ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- `backend/app/models/evolution.py` - –º–æ–¥–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ —ç–≤–æ–ª—é—Ü–∏–∏ –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- `backend/app/models/plan.py` - –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–û–±–Ω–æ–≤–ª–µ–Ω:** `backend/app/models/__init__.py` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

### 3. –°–µ—Ä–≤–∏—Å—ã
–°–æ–∑–¥–∞–Ω—ã —Å–µ—Ä–≤–∏—Å—ã:
- `backend/app/services/approval_service.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏
  - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  - –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ/–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
  
- `backend/app/services/artifact_generator.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ LLM
  - –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### 4. API Routes
–°–æ–∑–¥–∞–Ω—ã API endpoints:
- `backend/app/api/routes/approvals.py` - API –¥–ª—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
  - `GET /api/approvals/` - —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  - `GET /api/approvals/{id}` - –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞
  - `POST /api/approvals/{id}/approve` - —É—Ç–≤–µ—Ä–¥–∏—Ç—å
  - `POST /api/approvals/{id}/reject` - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å
  - `POST /api/approvals/{id}/modify` - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å

- `backend/app/api/routes/artifacts.py` - API –¥–ª—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
  - `GET /api/artifacts/` - —Å–ø–∏—Å–æ–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
  - `GET /api/artifacts/{id}` - –¥–µ—Ç–∞–ª–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
  - `POST /api/artifacts/` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
  - `DELETE /api/artifacts/{id}` - —É–¥–∞–ª–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç

- `backend/app/api/routes/prompts.py` - API –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤
  - `GET /api/prompts/` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤
  - `GET /api/prompts/{id}` - –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–º–ø—Ç–∞
  - `POST /api/prompts/` - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç
  - `PUT /api/prompts/{id}` - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç
  - `DELETE /api/prompts/{id}` - —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç

**–û–±–Ω–æ–≤–ª–µ–Ω:** `backend/main.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ routers

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
```bash
cd backend
alembic upgrade head
```

### 2. –°–æ–∑–¥–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- `frontend/templates/approvals/queue.html` - –æ—á–µ—Ä–µ–¥—å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
- `frontend/templates/approvals/detail.html` - –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞
- `frontend/templates/artifacts/list.html` - —Å–ø–∏—Å–æ–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- `frontend/templates/artifacts/detail.html` - –¥–µ—Ç–∞–ª–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
- `frontend/templates/artifacts/create.html` - —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
- `prompt_evolution.py` - —ç–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- `feedback_processor.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- `planning_service.py` - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
- `evolution_engine.py` - –¥–≤–∏–∂–æ–∫ —ç–≤–æ–ª—é—Ü–∏–∏ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —ç–≤–æ–ª—é—Ü–∏–∏

### –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ —á–µ—Ä–µ–∑ API
2. `ArtifactGenerator` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ LLM
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ (–¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤) –∏–ª–∏ –ø—Ä–æ–º–ø—Ç (–¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤)
4. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
5. –°–æ–∑–¥–∞–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ `WAITING_APPROVAL`
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç/–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
8. –ü—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

### –ü—Ä–æ—Ü–µ—Å—Å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
1. –ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ –æ—á–µ—Ä–µ–¥–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
3. –ú–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ (–∫–æ–¥, –ø—Ä–æ–º–ø—Ç, –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
4. –£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
5. –ü—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞:**
```bash
curl -X POST http://localhost:8000/api/artifacts/ \
  -H "Content-Type: application/json" \
  -d '{
    "description": "Create a tool to search files by name",
    "artifact_type": "tool"
  }'
```

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π:**
```bash
curl http://localhost:8000/api/approvals/
```

3. **–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8000/api/approvals/{request_id}/approve \
  -H "Content-Type: application/json" \
  -d '{"feedback": "Looks good!"}'
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞ `"user"` –¥–ª—è `created_by` –∏ `approved_by`. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –Ω–æ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è production.

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–¥–∞ (—Å–∏–Ω—Ç–∞–∫—Å–∏—Å), –Ω–æ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

4. **–ü–∞–º—è—Ç—å:** –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Å–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ–π (–ø–æ —Ç–∏–ø—É). –í –±—É–¥—É—â–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å embeddings.

5. **–ü–∞—Ä—Å–∏–Ω–≥ JSON:** –í `_analyze_requirements` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ LLM.

## üìù –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
- ‚úÖ –ú–æ–¥–µ–ª–∏
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (approval, artifact_generator)
- ‚úÖ API endpoints
- ‚è≥ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø)
- ‚è≥ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (prompt_evolution, feedback_processor)
- ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–∞–º—è—Ç–∏
- ‚è≥ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á

