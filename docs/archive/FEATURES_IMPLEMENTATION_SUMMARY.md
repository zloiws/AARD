# ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQLAlchemy

**–ü—Ä–æ–±–ª–µ–º–∞:** SQL –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–∫–ª—é—á–µ–Ω `echo=True` –≤ `create_engine()` 
- –ù–∞—Å—Ç—Ä–æ–µ–Ω logger –¥–ª—è `sqlalchemy.engine` –Ω–∞ —É—Ä–æ–≤–µ–Ω—å WARNING
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `LOG_SQLALCHEMY` –≤ `.env`

**–§–∞–π–ª—ã:**
- `backend/app/core/database.py` - –æ—Ç–∫–ª—é—á–µ–Ω echo, –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ logger
- `backend/app/core/logging_config.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `.env`:**
```env
LOG_SQLALCHEMY=false  # –û—Ç–∫–ª—é—á–∏—Ç—å SQL –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

## 2. ‚úÖ –î–æ–¥–µ–ª–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ö–Ω–æ–ø–∫–∞ "‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –û—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ `AbortController` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- Endpoint `/api/chat/cancel` –¥–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã —Å –ø–æ–∫–∞–∑–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–§–∞–π–ª—ã:**
- `backend/app/api/routes/chat.py` - –¥–æ–±–∞–≤–ª–µ–Ω endpoint `/api/chat/cancel`
- `frontend/templates/main.html` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `stopGeneration()`

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è `AbortController`
2. –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
3. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `abort()` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/chat/cancel`
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ

## 3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä—É—á–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- Endpoint `POST /api/models/{model_id}/unload` –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
- –ö–Ω–æ–ø–∫–∞ "üì§ –í—ã–≥—Ä—É–∑–∏—Ç—å" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `/api/ps` Ollama API

**–§–∞–π–ª—ã:**
- `backend/app/api/routes/models_management.py` - –¥–æ–±–∞–≤–ª–µ–Ω endpoint `unload_model()`
- `frontend/templates/settings/index.html` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∏ —Ñ—É–Ω–∫—Ü–∏—è `unloadModel()`

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ –º–æ–¥–µ–ª—å –≤ GPU —á–µ—Ä–µ–∑ `/api/ps`
2. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–ø—Ä—è–º–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Ollama API)
3. –ï—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - —Å–æ–æ–±—â–∞–µ—Ç –æ–± —ç—Ç–æ–º

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- Ollama API –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ endpoint –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –∏–∑ GPU
- –ú–æ–¥–µ–ª—å –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Ollama (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## 4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –∏–∑ GPU –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- Endpoint `POST /api/models/{model_id}/unload-from-gpu` (–∑–∞–≥–ª—É—à–∫–∞)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- TODO –ø–æ–º–µ—Ç–∫–∏ –≤ –∫–æ–¥–µ

**–§–∞–π–ª—ã:**
- `backend/app/api/routes/models_management.py` - –¥–æ–±–∞–≤–ª–µ–Ω endpoint `unload_model_from_gpu()`

**TODO (–ø–æ–º–µ—á–µ–Ω–æ –≤ –∫–æ–¥–µ):**
```python
# TODO: Implement automatic GPU unload logic:
# 1. Check which model is currently loaded in GPU
# 2. If different from requested model, unload current model
# 3. Load requested model
# 4. Handle errors gracefully
```

**–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
1. –í `OllamaClient.generate()` –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/api/ps` - –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞
   - –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å - –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–≥—Ä—É–∑–∏—Ç—å
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - –ï—Å–ª–∏ –≤—ã–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª—å—é –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è:**
- Ollama API –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ endpoint –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏
- –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
  - –ñ–¥–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–∞–π–º–∞—É—Ç–∞ (–Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å workaround (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  - –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ Ollama (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ)

## üìã –°–ø–∏—Å–æ–∫ TODO –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### –í—ã–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∏–∑ GPU –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

**–§–∞–π–ª:** `backend/app/api/routes/models_management.py`
**–§—É–Ω–∫—Ü–∏—è:** `unload_model_from_gpu()`

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–≥–ª—É—à–∫–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
2. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `/api/ps`
3. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–≥—Ä—É–∑–∫–∏ (–∫–æ–≥–¥–∞ API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω)
4. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `OllamaClient.generate()`
5. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
6. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Ollama API)

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

1. ‚úÖ SQLAlchemy –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ
2. ‚úÖ –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –†—É—á–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏)
4. ‚úÖ –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ —Å–æ–∑–¥–∞–Ω–∞ —Å TODO

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

