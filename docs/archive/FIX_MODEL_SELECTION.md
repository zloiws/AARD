# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–æ–¥–µ–ª—å—é –∏–∑ .env

## üîç –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ú–æ–¥–µ–ª—å `huihui_ai/deepseek-r1-abliterated:8b` –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –∏–∑-–∑–∞ fallback –Ω–∞ `.env` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `OllamaClient.generate()`.

### –¶–µ–ø–æ—á–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä/–º–æ–¥–µ–ª—å:**
   - `server_id = ""` –∏ `model = ""` –≤ frontend
   - –ù–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ API (–ø—Ä–æ–≤–µ—Ä–∫–∞ `if (serverId && serverId.trim())`)
   - –í `chat.py`: `selected_server_url = None`, `selected_model = None`

2. **–í `OllamaClient.generate()`:**
   - –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **PRIORITY 3** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `self.instances` –∏–∑ `.env`:
   ```python
   self._instances = [
       self.settings.ollama_instance_1,  # <-- –ò–ó .env!
       self.settings.ollama_instance_2,  # <-- –ò–ó .env!
   ]
   ```
   - `actual_model_name = None` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `instance.model` –∏–∑ `.env`

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏–∑ `.env` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `chat.py`

**–î–æ:**
- –ï—Å–ª–∏ `server_id` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω ‚Üí `selected_server_url = None`
- –ï—Å–ª–∏ `model` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω ‚Üí `selected_model = None`
- –ü–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –≤ `OllamaClient.generate()` ‚Üí fallback –Ω–∞ `.env`

**–ü–æ—Å–ª–µ:**
- **PRIORITY 1:** –ï—Å–ª–∏ `server_id` –ø–µ—Ä–µ–¥–∞–Ω ‚Üí –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –ë–î
- **PRIORITY 2:** –ï—Å–ª–∏ `model` –ø–µ—Ä–µ–¥–∞–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ
- **PRIORITY 3:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–∑ –ë–î (–ù–ï –∏–∑ .env):
  - –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –ë–î
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–µ—Ä–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏–∑ –ë–î
  - –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª–∏ –∏–∑ –ë–î –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
  - –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—É—é –∞–∫—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:**
```python
# –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ë–î, –Ω–∏–∫–æ–≥–¥–∞ .env
if not selected_server:
    selected_server = OllamaService.get_default_server(db)
    if not selected_server:
        servers = OllamaService.get_all_active_servers(db)
        if servers:
            selected_server = servers[0]  # <-- –ò–ó –ë–î, –ù–ï –ò–ó .env!
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `OllamaClient.generate()`

**–î–æ:**
- –ï—Å–ª–∏ `server_url` –ø–µ—Ä–µ–¥–∞–Ω, –Ω–æ `model` –Ω–µ—Ç ‚Üí –∏—Å–∫–∞–ª –≤ `.env`
- –ï—Å–ª–∏ `model` –ø–µ—Ä–µ–¥–∞–Ω, –Ω–æ `server_url` –Ω–µ—Ç ‚Üí –∏—Å–∫–∞–ª –≤ `.env`
- –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `.env`

**–ü–æ—Å–ª–µ:**
- –ï—Å–ª–∏ `server_url` –∏ `model` –ø–µ—Ä–µ–¥–∞–Ω—ã ‚Üí —Å–æ–∑–¥–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç–∞–Ω—Å (OK)
- –ï—Å–ª–∏ `server_url` –ø–µ—Ä–µ–¥–∞–Ω, –Ω–æ `model` –Ω–µ—Ç ‚Üí –æ—à–∏–±–∫–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ `chat.py`)
- –ï—Å–ª–∏ `model` –ø–µ—Ä–µ–¥–∞–Ω, –Ω–æ `server_url` –Ω–µ—Ç ‚Üí –æ—à–∏–±–∫–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ `chat.py`)
- –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ ‚Üí –æ—à–∏–±–∫–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ `chat.py`)

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:**
```python
# –£–±—Ä–∞–Ω—ã –≤—Å–µ fallback –Ω–∞ .env
# –¢–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ–º, —á—Ç–æ–±—ã server_url –∏ model –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã
if server_url and model:
    instance = self._create_dynamic_instance(server_url, model)
    # OK - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
else:
    raise OllamaError("Server URL and model must be provided")
```

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ë–î:**
   - –°–µ—Ä–≤–µ—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î
   - –ú–æ–¥–µ–ª–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î
   - –ù–∏–∫–∞–∫–∏—Ö fallback –Ω–∞ `.env`

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Å–µ—Ä–≤–µ—Ä –∏ –º–æ–¥–µ–ª—å ‚Üí –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–ª ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–∑ –ë–î
   - –°–µ—Ä–≤–µ—Ä/–º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ë–î ‚Üí –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –º–æ–¥–µ–ª–∏
   - –í–∏–¥–Ω–æ, –æ—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è (–ë–î –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤—ã–±–æ—Ä)

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞ –∏ –º–æ–¥–µ–ª–∏:**
   - –î–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
   - –í –ª–æ–≥–∞—Ö: `[CHAT] Using server ...` –∏ `[CHAT] Using model: ...`

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä:**
   - –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä/–º–æ–¥–µ–ª—å –∏–∑ –ë–î
   - –í –ª–æ–≥–∞—Ö: `[CHAT] Auto-selected server: ...` –∏ `[CHAT] Auto-selected model: ...`

3. **–ù–∏–∫–∞–∫–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ .env:**
   - –ú–æ–¥–µ–ª—å `huihui_ai/deepseek-r1-abliterated:8b` –Ω–µ –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –≤ –ë–î

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –∏ –º–æ–¥–µ–ª–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä/–º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞

