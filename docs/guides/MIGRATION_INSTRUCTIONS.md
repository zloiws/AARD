# Инструкция по применению миграций

## Быстрый старт

Для применения миграций используйте скрипт из корневой директории проекта:

```bash
.\venv\Scripts\python.exe apply_migrations.py
```

Или активируйте виртуальное окружение и запустите:

```powershell
.\venv\Scripts\Activate.ps1
python apply_migrations.py
```

## Проблема с отсутствующими таблицами

Если вы видите ошибку типа `relation "ollama_models" does not exist`, это означает, что в базе данных отсутствуют таблицы, которые должны были быть созданы предыдущими миграциями.

### Решение 1: Применить все миграции с начала

Если база данных пустая или миграции не были применены, нужно применить их все:

```bash
.\venv\Scripts\python.exe apply_migrations.py
```

Скрипт попытается применить все миграции по порядку.

### Решение 2: Проверить текущее состояние

Проверьте, какие миграции уже применены в базе данных:

```sql
SELECT * FROM alembic_version;
```

### Решение 3: Создать таблицы вручную

Если некоторые таблицы отсутствуют, их можно создать вручную или применить миграции по одной, начиная с первой.

## Миграции для Phase 3

Phase 3 добавляет следующие миграции:
- `022_add_project_metrics.py` - таблица project_metrics
- `023_add_audit_reports.py` - таблица audit_reports

Эти миграции требуют, чтобы предыдущие миграции были применены.

## Альтернативный способ (через alembic напрямую)

Если скрипт не работает, можно использовать alembic напрямую:

```bash
cd backend
..\venv\Scripts\python.exe -m alembic upgrade head
```

Но для этого нужно, чтобы alembic был доступен как модуль.

