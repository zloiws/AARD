1. Назначение
Создать веб-интерфейс для реального времени отображения всех взаимодействий между пользователем, агентами, моделями и инструментами. Цель — обеспечить полную прозрачность, контроль и возможность аудита процессов в рамках многоагентной системы.

2. Функциональные требования
2.1. Отображение потока событий (Event Stream)
Показывать хронологическую ленту всех событий в реальном времени.
Каждое событие должно иметь:
Временную метку (точность до миллисекунд).
Источник (от кого: User, Planner Agent, Coder Agent, Validator, Tool:X).
Тип события (User Input, Model Request, Model Response, Tool Call, Tool Result, Plan Update, Approval Request, Error).
Содержание (текст запроса, ответа, параметров вызова инструмента и т.д.).
Статус выполнения (в процессе, завершено, ошибка).
2.2. Детализация по компонентам
Пользовательский ввод: Чётко отображать исходный запрос пользователя (например, "найди и сравни все цены на iPhone с 13го по 15й").
Взаимодействие с моделью:
Показывать полный промпт, отправленный модели (включая system prompt, контекст, историю).
Показывать ответ модели (сырой вывод, до обработки).
Указывать, какая модель использовалась (например, qwen3-coder:30b-a3b-q4_K_M).
Вызовы инструментов:
Отображать структурированный JSON вызова функции (tool call).
Показывать результат выполнения (stdout, stderr, выходные данные).
Указывать статус выполнения (успех/ошибка).
Планирование:
Визуализировать активный ToDo-список с текущими статусами задач.
Показывать историю изменений плана (когда добавлена/удалена/изменена задача).
Отображать причину изменения плана (например, "Ошибка парсинга → Добавлена задача 'Использовать прокси'").
2.3. Управление и контроль
Утверждение действий: При достижении точки PENDING_APPROVAL показывать модальное окно или панель с запросом на подтверждение. Должна быть кнопка "Approve" / "Reject".
Принудительная остановка: Кнопка "Stop Execution", которая останавливает весь текущий workflow.
Ручное добавление задачи: Поле для ввода, позволяющее человеку вручную добавить задачу в ToDo-список.
2.4. Визуализация состояния системы
Диаграмма взаимодействия (Sequence Diagram): Автоматически генерируемая UML-подобная диаграмма, показывающая поток сообщений между компонентами.
Граф состояний (State Graph): Визуализация текущего графа LangGraph с выделением активного узла.
Индикаторы ресурсов: Отображение нагрузки на Ollama (GPU, RAM), количество активных сессий.
3. Нефункциональные требования
Реальное время: Задержка отслеживания не более 500 мс.
Масштабируемость: Поддержка одновременного отслеживания нескольких независимых задач (workflow instances).
Надёжность: Все события должны сохраняться в базе данных (PostgreSQL) даже при перезагрузке интерфейса.
Безопасность: Доступ к интерфейсу только по авторизации. Возможность скрытия чувствительных данных (например, API-ключей) в логах.
Производительность: Интерфейс должен оставаться отзывчивым при большом объёме событий (1000+ записей).
4. Архитектурные требования
4.1. Интеграция с существующей системой
Использовать OpenTelemetry для сбора трассировок (traces) и событий (events).
Все компоненты системы (Planner, Coder, Tools) должны эмитировать события через единый event bus (например, Redis Pub/Sub или Kafka).
Backend модуля должен подписываться на этот event bus и сохранять события в PostgreSQL.
4.2. Технологический стек
Frontend: HTMX (по вашему предпочтению) или React. HTMX предпочтителен для быстрой итерации и интеграции с OpenWebUI.
Backend: Python (FastAPI или Flask) для обработки событий и API.
База данных: PostgreSQL (для хранения событий, планов, метаданных).
Шина событий: Redis Pub/Sub (простота и скорость) или RabbitMQ.
Интерфейс к Ollama: Прямые HTTP-вызовы к вашему Ollama API (указанному IP:порт).
4.3. API
REST API для получения истории событий.
WebSocket API для push-уведомлений о новых событиях в реальном времени.
API для отправки команд (утверждение, остановка).
5. Выходные данные
Единая веб-страница с двумя основными панелями:
Лента событий (слева, вертикальная).
Детальный просмотр (справа): динамически меняется в зависимости от выбранного события (показывает промпт, ответ, результат инструмента и т.д.).
Вкладки: "Активная задача", "История", "Метрики".