# Execution Graph Service — implementation notes\n\nThis document describes `ExecutionGraphService` implemented at `backend/app/services/execution_graph_service.py`.\n\n## Purpose\n\nManage execution graphs per chat session: create graphs, add nodes/edges, update node statuses. The service is lightweight and designed to be usable with either a provided SQLAlchemy session (for transactional flows) or by creating short-lived sessions.\n\n## API\n\n- `create_or_get_graph(session_id)` — returns existing graph or creates new one\n- `add_node(graph_id, node_type, name=None, data=None, status='pending', chat_message_id=None)` — create ExecutionNode\n- `add_edge(graph_id, source_node_id, target_node_id, label=None, data=None)` — create ExecutionEdge\n- `update_node_status(node_id, status, result_data=None)` — update node status and timestamps\n\n## Integration points\n\n- `backend/app/api/routes/chat.py` — when a user message is received, a user node is added; assistant response adds response node and creates an edge between them.\n- `backend/app/services/*` — services executing plan steps should add nodes and update their statuses using this service.\n\n## Notes\n\n- Service accepts optional `db` parameter to reuse existing session (useful inside request handling), otherwise uses `SessionLocal` for short-lived sessions.\n\n*** End Patch"}]**response** речи****

