# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ API

**Backend:**
- ‚úÖ `GET /api/models/servers` - —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ `GET /api/models/server/models?server_url=...` - –º–æ–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ

**Frontend:**
- ‚úÖ –ù–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ (`index_new.html`)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ JavaScript
- ‚úÖ –í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

**–§–∞–π–ª—ã:**
- `backend/app/api/routes/models.py` - API endpoints
- `frontend/templates/index_new.html` - –Ω–æ–≤—ã–π UI

### 2. –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –≤ UI
- ‚úÖ Endpoint `/api/chat/cancel/{task_id}` (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á (`_active_tasks`)

**–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å streaming –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ asyncio.CancelledError
- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ session_id –≤–º–µ—Å—Ç–æ task_id

### 3. –ß–∞—Ç –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `POST /api/chat/multi-model` - endpoint
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
- ‚úÖ –ü–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

**–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ `ChatSessionManager` (in-memory)
- ‚úÖ `POST /api/chat/session` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ `GET /api/chat/session/{session_id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ—Å—Å–∏–∏

**–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (—Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –ø–∞–º—è—Ç—å - —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ session_id –∏–∑ LocalStorage
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 5. –í–∫–ª–∞–¥–∫–∞ –º–µ—Ç—Ä–∏–∫–∏

**–°—Ç–∞—Ç—É—Å:** –ó–∞–≥–ª—É—à–∫–∞ —Å–æ–∑–¥–∞–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üìã –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend:
- `backend/app/api/routes/models.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏
- `backend/app/core/chat_session.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `backend/app/api/routes/chat.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ endpoints

### Frontend:
- `frontend/templates/index_new.html` - –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≤–∫–ª–∞–¥–∫–∞–º–∏

### –¢–µ—Å—Ç—ã:
- `backend/test_new_features.py` - —Ç–µ—Å—Ç—ã –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- `backend/test_ollama_connection.py` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üîß –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü—Ä–æ GPU –∏ –º–æ–¥–µ–ª–∏

**–í–∞–∂–Ω–æ:** –ú–æ–¥–µ–ª–∏ –≤ Ollama –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ GPU **–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é**, –∞ –Ω–µ –∑–∞—Ä–∞–Ω–µ–µ.

1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –º–æ–¥–µ–ª–∏ –æ–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ GPU
2. –ú–æ–¥–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤ GPU –ø–∞–º—è—Ç–∏ –¥–æ –≤—ã–≥—Ä—É–∑–∫–∏ (timeout –∏–ª–∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏: `curl http://10.39.0.101:11434/api/ps`

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Ollama** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

### –ü—Ä–æ health check

Health check –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ, —Ç–∞–∫ –∫–∞–∫:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
- –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π

–î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –º–æ–∂–Ω–æ:
- –î–µ–ª–∞—Ç—å health check –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å "–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è..." –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π:

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
GET /api/models/servers

# –ú–æ–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
GET /api/models/server/models?server_url=http://10.39.0.101:11434/v1
```

### –†–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏:

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
POST /api/chat/session
{"title": "My chat"}

# –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
GET /api/chat/session/{session_id}
```

### –ú—É–ª—å—Ç–∏-–º–æ–¥–µ–ª—å–Ω—ã–π —á–∞—Ç:

```bash
POST /api/chat/multi-model
{
  "models": ["model1", "model2"],
  "initial_message": "–ù–∞—á–Ω–∏ –¥–∏–∞–ª–æ–≥",
  "system_prompts": {
    "model1": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–æ–¥—É",
    "model2": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ"
  },
  "max_turns": 10
}
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
2. **–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ –ë–î** - —á—Ç–æ–±—ã –∏—Å—Ç–æ—Ä–∏—è –Ω–µ —Ç–µ—Ä—è–ª–∞—Å—å
3. **–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ç–º–µ–Ω–∞ streaming
4. **UI –¥–ª—è –º—É–ª—å—Ç–∏-–º–æ–¥–µ–ª—å–Ω–æ–≥–æ —á–∞—Ç–∞** - —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
5. **–ú–µ—Ç—Ä–∏–∫–∏** - —Å–±–æ—Ä –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

