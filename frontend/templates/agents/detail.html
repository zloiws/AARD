{% extends "base.html" %}

{% block title %}{{ agent.name }} - –ê–≥–µ–Ω—Ç{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f8f9fa;
    }
    .card {
        border: 1px solid #dee2e6;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    .metric-card {
        text-align: center;
        padding: 20px;
    }
    .metric-value {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 8px;
    }
    .metric-label {
        font-size: 14px;
        color: #6c757d;
    }
    .capability-badge {
        display: inline-block;
        padding: 6px 12px;
        margin: 4px;
        background: #e9ecef;
        border-radius: 6px;
        font-size: 12px;
    }
    .status-badge {
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>{{ agent.name }}</h1>
            <p class="text-muted mb-0">{{ agent.description or '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è' }}</p>
        </div>
        <div>
            <a href="/agents/{{ agent.id }}/edit" class="btn btn-outline-primary me-2">
                <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
            <a href="/agents" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>–°—Ç–∞—Ç—É—Å:</strong>
                            {% if agent.status == 'active' %}
                                <span class="status-badge bg-success text-white ms-2">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            {% elif agent.status == 'draft' %}
                                <span class="status-badge bg-warning text-dark ms-2">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                            {% elif agent.status == 'paused' %}
                                <span class="status-badge bg-secondary text-white ms-2">–ù–∞ –ø–∞—É–∑–µ</span>
                            {% elif agent.status == 'waiting_approval' %}
                                <span class="status-badge bg-info text-white ms-2">–û–∂–∏–¥–∞–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</span>
                            {% elif agent.status == 'deprecated' %}
                                <span class="status-badge bg-dark text-white ms-2">–£—Å—Ç–∞—Ä–µ–ª</span>
                            {% elif agent.status == 'failed' %}
                                <span class="status-badge bg-danger text-white ms-2">–û—à–∏–±–∫–∞</span>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <strong>–í–µ—Ä—Å–∏—è:</strong> <span class="ms-2">v{{ agent.version }}</span>
                        </div>
                    </div>
                    
                    {% if agent.system_prompt %}
                    <div class="mb-3">
                        <strong>–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:</strong>
                        <div class="mt-2 p-3 bg-light rounded">{{ agent.system_prompt }}</div>
                    </div>
                    {% endif %}
                    
                    {% if agent.capabilities %}
                    <div class="mb-3">
                        <strong>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</strong>
                        <div class="mt-2">
                            {% for capability in agent.capabilities %}
                                <span class="capability-badge">{{ capability }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="row">
                        <div class="col-md-6">
                            <strong>–ú–æ–¥–µ–ª—å:</strong> 
                            <span class="ms-2">{{ agent.model_preference or '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä' }}</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Temperature:</strong> 
                            <span class="ms-2">{{ agent.temperature or '0.7' }}</span>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <strong>–°–æ–∑–¥–∞–Ω:</strong> 
                            <span class="ms-2">{{ agent.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                        </div>
                        <div class="col-md-6">
                            <strong>–û–±–Ω–æ–≤–ª–µ–Ω:</strong> 
                            <span class="ms-2">{{ agent.updated_at.strftime('%Y-%m-%d %H:%M') }}</span>
                        </div>
                    </div>
                    
                    {% if agent.last_used_at %}
                    <div class="mt-3">
                        <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</strong> 
                        <span class="ms-2">{{ agent.last_used_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìä –ú–µ—Ç—Ä–∏–∫–∏</h5>
                </div>
                <div class="card-body">
                    <div class="metric-card">
                        <div class="metric-value">{{ metrics.total_tasks }}</div>
                        <div class="metric-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                    </div>
                    <hr>
                    <div class="metric-card">
                        <div class="metric-value text-success">{{ metrics.successful_tasks }}</div>
                        <div class="metric-label">–£—Å–ø–µ—à–Ω—ã—Ö</div>
                    </div>
                    <hr>
                    <div class="metric-card">
                        <div class="metric-value text-danger">{{ metrics.failed_tasks }}</div>
                        <div class="metric-label">–ù–µ—É–¥–∞—á–Ω—ã—Ö</div>
                    </div>
                    <hr>
                    <div class="metric-card">
                        <div class="metric-value">{{ metrics.success_rate }}</div>
                        <div class="metric-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                    {% if metrics.average_execution_time %}
                    <hr>
                    <div class="metric-card">
                        <div class="metric-value">{{ (metrics.average_execution_time / 1000)|round(1) }}s</div>
                        <div class="metric-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="btn-group" role="group">
                        {% if agent.status == 'draft' or agent.status == 'paused' %}
                        <button type="button" class="btn btn-success" onclick="activateAgent('{{ agent.id }}')">
                            <i class="bi bi-play-circle"></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        {% endif %}
                        {% if agent.status == 'active' %}
                        <button type="button" class="btn btn-warning" onclick="pauseAgent('{{ agent.id }}')">
                            <i class="bi bi-pause-circle"></i> –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                        </button>
                        {% endif %}
                        <button type="button" class="btn btn-danger" onclick="deleteAgent('{{ agent.id }}')">
                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function activateAgent(agentId) {
    if (!confirm('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞?')) return;
    
    try {
        const response = await fetch(`/api/agents/${agentId}/activate`, {
            method: 'POST'
        });
        
        if (response.ok) {
            location.reload();
        } else {
            const data = await response.json();
            alert('–û—à–∏–±–∫–∞: ' + (data.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞'));
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

async function pauseAgent(agentId) {
    if (!confirm('–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≥–µ–Ω—Ç–∞?')) return;
    
    try {
        const response = await fetch(`/api/agents/${agentId}/pause`, {
            method: 'POST'
        });
        
        if (response.ok) {
            location.reload();
        } else {
            const data = await response.json();
            alert('–û—à–∏–±–∫–∞: ' + (data.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≥–µ–Ω—Ç–∞'));
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}

async function deleteAgent(agentId) {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∞–≥–µ–Ω—Ç–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
    
    try {
        const response = await fetch(`/api/agents/${agentId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            window.location.href = '/agents';
        } else {
            const data = await response.json();
            alert('–û—à–∏–±–∫–∞: ' + (data.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∞–≥–µ–Ω—Ç–∞'));
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
}
</script>
{% endblock %}

