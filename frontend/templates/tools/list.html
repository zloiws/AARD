{% extends "base.html" %}

{% block title %}–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã{% endblock %}

{% block body_class %}iframe-page{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #f8f9fa;
        padding: 0;
        margin: 0;
        min-height: auto;
        display: block;
    }
    
    body.iframe-page {
        background: #f8f9fa;
        padding: 0;
        margin: 0;
        min-height: auto;
        display: block;
    }
    .card {
        border: 1px solid #dee2e6;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .card-title {
        color: #212529;
        font-weight: 600;
    }
    .text-muted {
        color: #6c757d !important;
    }
    .badge {
        font-weight: 500;
    }
    .table {
        background: white;
    }
    .table th {
        background-color: #f8f9fa;
        color: #212529;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }
    .table td {
        color: #212529;
        border-bottom: 1px solid #e9ecef;
    }
    .btn-primary {
        background-color: #667eea;
        border-color: #667eea;
    }
    .btn-primary:hover {
        background-color: #5568d3;
        border-color: #5568d3;
    }
    .tool-card {
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
    }
    .tool-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .category-badge {
        display: inline-block;
        padding: 4px 8px;
        margin: 2px;
        background: #e9ecef;
        border-radius: 4px;
        font-size: 11px;
    }
    .metrics-row {
        display: flex;
        gap: 20px;
        margin-top: 10px;
    }
    .metric-item {
        flex: 1;
        text-align: center;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 6px;
    }
    .metric-value {
        font-size: 18px;
        font-weight: 600;
        color: #667eea;
    }
    .metric-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h1>
        <a href="/tools/create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        </a>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ total_tools }}</h5>
                    <p class="card-text text-muted">–í—Å–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-success">{{ active_tools }}</h5>
                    <p class="card-text text-muted">–ê–∫—Ç–∏–≤–Ω—ã—Ö</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-warning">{{ tools_by_status.draft|length }}</h5>
                    <p class="card-text text-muted">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title text-secondary">{{ tools_by_status.deprecated|length }}</h5>
                    <p class="card-text text-muted">–£—Å—Ç–∞—Ä–µ–≤—à–∏—Ö</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" onclick="filterTools('all')">
                    –í—Å–µ
                </button>
                <button type="button" class="btn btn-outline-success" onclick="filterTools('active')">
                    –ê–∫—Ç–∏–≤–Ω—ã–µ
                </button>
                <button type="button" class="btn btn-outline-warning" onclick="filterTools('draft')">
                    –ß–µ—Ä–Ω–æ–≤–∏–∫–∏
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="filterTools('deprecated')">
                    –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ
                </button>
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
    {% if tools %}
    <div class="row">
        {% for tool in tools %}
        <div class="col-md-6 col-lg-4 mb-4 tool-card" data-status="{{ tool.status }}" onclick="window.location.href='/tools/{{ tool.id }}'">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0">{{ tool.name }}</h5>
                        {% if tool.status == 'active' %}
                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% elif tool.status == 'draft' %}
                            <span class="badge bg-warning">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                        {% elif tool.status == 'waiting_approval' %}
                            <span class="badge bg-info">–û–∂–∏–¥–∞–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</span>
                        {% elif tool.status == 'deprecated' %}
                            <span class="badge bg-secondary">–£—Å—Ç–∞—Ä–µ–ª</span>
                        {% elif tool.status == 'failed' %}
                            <span class="badge bg-danger">–û—à–∏–±–∫–∞</span>
                        {% endif %}
                    </div>
                    
                    {% if tool.description %}
                    <p class="card-text text-muted small mb-2">{{ tool.description[:100] }}{% if tool.description|length > 100 %}...{% endif %}</p>
                    {% endif %}
                    
                    <div class="mb-2">
                        <span class="badge bg-secondary me-1">{{ tool.tool_type }}</span>
                        {% if tool.category %}
                            <span class="category-badge">{{ tool.category }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-item">
                            <div class="metric-value">{{ tool.total_executions }}</div>
                            <div class="metric-label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–π</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">{{ tool.success_rate or '0%' }}</div>
                            <div class="metric-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">{{ (tool.average_execution_time / 1000)|round(1) if tool.average_execution_time else 0 }}s</div>
                            <div class="metric-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
                        </div>
                    </div>
                    
                    <div class="mt-2 text-muted small">
                        <i class="bi bi-clock"></i> –°–æ–∑–¥–∞–Ω: {{ tool.created_at.strftime('%Y-%m-%d') }}
                        {% if tool.last_used_at %}
                        <br><i class="bi bi-activity"></i> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω: {{ tool.last_used_at.strftime('%Y-%m-%d %H:%M') }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center py-5">
            <h5 class="text-muted">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
            <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
            <a href="/tools/create" class="btn btn-primary mt-3">
                <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
            </a>
        </div>
    </div>
    {% endif %}
</div>

<script>
function filterTools(status) {
    const cards = document.querySelectorAll('.tool-card');
    const buttons = document.querySelectorAll('.btn-group button');
    
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    cards.forEach(card => {
        if (status === 'all' || card.dataset.status === status) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });
}
</script>
{% endblock %}

